<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kala Residency Payment System</title>

<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #333;
  padding: 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.container {
  width: 100%;
  max-width: 500px;
  background: #ffffff;
  padding: 32px;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

/* Header */
.header {
  text-align: center;
  margin-bottom: 32px;
  padding-bottom: 20px;
  border-bottom: 2px solid #f0f0f0;
}

.logo-circle {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 50%;
  margin: 0 auto 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 32px;
  font-weight: bold;
  color: white;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

h2 {
  color: #1a1a1a;
  font-size: 1.75rem;
  margin-bottom: 8px;
  font-weight: 700;
}

.subtitle {
  color: #666;
  font-size: 0.95rem;
}

/* Success Message */
.success-message {
  display: none;
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  color: white;
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 24px;
  text-align: center;
  font-weight: 600;
  box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
}

/* Form Inputs */
.form-group {
  margin-bottom: 24px;
}

label {
  font-weight: 600;
  margin-bottom: 10px;
  display: block;
  color: #333;
  font-size: 0.95rem;
}

input, select {
  width: 100%;
  padding: 16px;
  font-size: 16px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  transition: all 0.3s ease;
  background: #fafafa;
}

input:focus, select:focus {
  outline: none;
  border-color: #667eea;
  background: white;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

button {
  width: 100%;
  padding: 18px;
  font-size: 1.1rem;
  font-weight: 700;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
}

button:active {
  transform: translateY(0);
}

/* QR Section */
#qrSection {
  display: none;
  margin-top: 32px;
  text-align: center;
}

.qr-container {
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  border-radius: 20px;
  padding: 30px;
  margin-bottom: 24px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.qr-title {
  font-size: 1.3rem;
  font-weight: 700;
  color: #1a1a1a;
  margin-bottom: 20px;
}

#qrImage {
  width: 260px;
  height: 260px;
  margin: auto;
  display: block;
  border-radius: 16px;
  border: 4px solid white;
  padding: 12px;
  background: white;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

/* Details Box */
.qr-details-box {
  background: white;
  padding: 24px;
  border-radius: 16px;
  margin-top: 24px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
}

.detail-row {
  display: flex;
  justify-content: space-between;
  margin-bottom: 14px;
  padding-bottom: 14px;
  border-bottom: 1px solid #f0f0f0;
}

.detail-row:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.detail-label {
  font-weight: 600;
  color: #555;
}

.detail-value {
  font-weight: 700;
  color: #667eea;
}

/* Action Buttons */
.action-buttons {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 20px;
}

.btn-download {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
}

.btn-capture {
  background: linear-gradient(135deg, #fc4a1a 0%, #f7b733 100%);
}

/* Warning Box */
.note-box {
  margin-top: 24px;
  padding: 20px;
  background: linear-gradient(135deg, #fff8e6 0%, #ffe8cc 100%);
  border-left: 6px solid #ff9800;
  border-radius: 12px;
  font-size: 0.9rem;
  line-height: 1.7;
  text-align: left;
}

.note-box b {
  color: #e65100;
  display: block;
  margin-bottom: 6px;
}

/* Responsive */
@media (max-width: 480px) {
  .container {
    padding: 24px;
  }
  
  h2 {
    font-size: 1.5rem;
  }
  
  #qrImage {
    width: 220px;
    height: 220px;
  }
}
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <div class="logo-circle">KR</div>
    <h2>Kala Residency</h2>
    <p class="subtitle">Secure & Verified Online Payment System</p>
  </div>

  <div id="successMessage" class="success-message">
    ‚úì Payment details saved! QR Code generated successfully.
  </div>

  <!-- FORM -->
  <form id="payForm">
    <div class="form-group">
      <label>Flat/Shop Number</label>
      <select id="flat" required>
        <option value="">Select your flat/shop</option>
      </select>
    </div>

    <div class="form-group">
      <label>Full Name</label>
      <input id="userName" type="text" placeholder="Enter your name" required>
    </div>

    <div class="form-group">
      <label>Payment Month</label>
      <input type="month" id="month" required>
    </div>

    <div class="form-group">
      <label>Amount (‚Çπ)</label>
      <input type="number" id="amount" min="1" placeholder="Enter amount" required>
    </div>

    <div class="form-group">
      <label>Payment Purpose</label>
      <select id="purpose" required>
        <option>Maintenance</option>
        <option>Water Charges</option>
        <option>Parking</option>
        <option>Sinking Fund</option>
        <option>Other</option>
      </select>
    </div>

    <button type="submit">Generate Payment QR Code</button>
  </form>

  <!-- QR SECTION -->
  <div id="qrSection">

    <div class="qr-container">
      
      <h3 class="qr-title">üì± Scan to Pay via UPI</h3>
      
      <img id="qrImage" alt="Payment QR Code">

      <!-- DETAILS -->
      <div class="qr-details-box">
        <div class="detail-row">
          <div class="detail-label">Flat/Shop:</div>
          <div class="detail-value" id="qrFlat">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Name:</div>
          <div class="detail-value" id="qrName">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Amount:</div>
          <div class="detail-value" id="qrAmount">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Month:</div>
          <div class="detail-value" id="qrMonth">-</div>
        </div>
        <div class="detail-row">
          <div class="detail-label">Purpose:</div>
          <div class="detail-value" id="qrPurpose">-</div>
        </div>
      </div>

    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
      <button id="downloadQR" class="btn-download">‚¨á Download QR</button>
      <button id="screenshotQR" class="btn-capture">üì∏ Capture QR</button>
    </div>

    <!-- Warning -->
    <div class="note-box">
      <b>‚ö† ‡§Æ‡§π‡§§‡•ç‡§µ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡•Ç‡§ö‡§®‡§æ / Important Note:</b>
      <b>Hindi:</b> ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§∏ QR ‡§ï‡•ã ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§Ö‡§ó‡§≤‡•Ä ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§Ø‡§æ QR ‡§¨‡§®‡§æ‡§ï‡§∞ ‡§π‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§<br><br>
      <b>Marathi:</b> ‡§ï‡•É‡§™‡§Ø‡§æ ‡§π‡§æ QR ‡§´‡§ï‡•ç‡§§ ‡§è‡§ï‡§¶‡§æ‡§ö ‡§µ‡§æ‡§™‡§∞‡§æ. ‡§™‡•Å‡§¢‡•Ä‡§≤ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü‡§∏‡§æ‡§†‡•Ä ‡§®‡§µ‡•Ä‡§® QR ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡•Ç‡§®‡§ö ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡§∞‡§æ.<br><br>
      <b>English:</b> Please use this QR code only once. Generate a new QR code for the next payment.
    </div>

  </div>
</div>

<script>
// Fill Flats and Shops
const flatSelect = document.getElementById('flat');
for(let i = 1; i <= 21; i++) {
  flatSelect.innerHTML += `<option>Flat ${i}</option>`;
}
for(let i = 1; i <= 5; i++) {
  flatSelect.innerHTML += `<option>Shop ${i}</option>`;
}

// Set current month
document.getElementById('month').value = new Date().toISOString().slice(0, 7);

// SUBMIT HANDLER
document.getElementById('payForm').addEventListener("submit", async(e) => {
  e.preventDefault();

  const data = {
    flat: document.getElementById('flat').value,
    name: document.getElementById('userName').value,
    month: document.getElementById('month').value,
    amount: document.getElementById('amount').value,
    purpose: document.getElementById('purpose').value
  };

  // Update QR details
  document.getElementById('qrFlat').textContent = data.flat;
  document.getElementById('qrName').textContent = data.name;
  document.getElementById('qrAmount').textContent = "‚Çπ" + data.amount;
  document.getElementById('qrPurpose').textContent = data.purpose;
  document.getElementById('qrMonth').textContent = data.month;

  // Save to Google Sheets
  try {
    await fetch("https://script.google.com/macros/s/AKfycbwhPuy5qmFWA4nc_m6D5sgsfBmXavpGvdVEOW5jBoyAWdskiIQ9tKDnQaIh79CWl5B8/exec", {
      method: "POST",
      body: JSON.stringify(data)
    });
  } catch(e) {
    console.log("Data save error:", e);
  }

  // Show success message
  document.getElementById('successMessage').style.display = "block";

  // Generate UPI link
  const note = `${data.flat} - ${data.name} - ${data.month} - ${data.purpose}`;
  const upi = `upi://pay?pa=9766893279@kotak811&pn=DEVENDRA%20KAPOORE&am=${data.amount}&cu=INR&tn=${encodeURIComponent(note)}`;

  // Display QR
  document.getElementById('qrImage').src = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(upi)}`;
  
  // Show QR section
  document.getElementById('qrSection').style.display = "block";
  
  // Scroll to QR
  document.getElementById('qrSection').scrollIntoView({ behavior: 'smooth' });

  // ENHANCED FRAMED QR GENERATOR with Two-Column Payment Details
  async function generateFramedQR() {
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 800;
    canvas.height = 1200;

    // Background
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, 800, 1200);

    // Header gradient
    const gradient = ctx.createLinearGradient(0, 0, 800, 0);
    gradient.addColorStop(0, '#667eea');
    gradient.addColorStop(1, '#764ba2');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, 800, 160);

    // Title without logo
    ctx.fillStyle = "#ffffff";
    ctx.font = "bold 36px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Kala Residency", 400, 100);
    ctx.font = "18px Arial";
    ctx.fillText("Secure & Verified Online Payment System", 400, 130);

    // Load and draw QR code
    const img = new Image();
    img.crossOrigin = "Anonymous";
    img.src = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(upi)}`;
    await new Promise(resolve => img.onload = resolve);

    // QR background with enhanced styling
    ctx.fillStyle = "#f5f7fa";
    ctx.fillRect(150, 200, 500, 500);
    ctx.strokeStyle = "#667eea";
    ctx.lineWidth = 6;
    ctx.strokeRect(150, 200, 500, 500);
    
    // Inner QR border
    ctx.strokeStyle = "#764ba2";
    ctx.lineWidth = 3;
    ctx.strokeRect(165, 215, 470, 470);

    // Draw QR
    ctx.drawImage(img, 190, 240, 420, 420);

    // Scan instruction
    ctx.fillStyle = "#667eea";
    ctx.font = "bold 26px Arial";
    ctx.fillText("üì± Scan to Pay via UPI", 400, 750);

    // Enhanced Details box with TWO COLUMNS
    ctx.fillStyle = "#ffffff";
    ctx.fillRect(80, 780, 640, 240);
    ctx.strokeStyle = "#667eea";
    ctx.lineWidth = 4;
    ctx.strokeRect(80, 780, 640, 240);
    
    // Inner details border
    ctx.strokeStyle = "#e0e0e0";
    ctx.lineWidth = 2;
    ctx.strokeRect(90, 790, 620, 220);

    // Details title
    ctx.fillStyle = "#333333";
    ctx.font = "bold 24px Arial";
    ctx.textAlign = "center";
    ctx.fillText("Payment Details", 400, 825);

    // Details content in TWO COLUMNS
    ctx.fillStyle = "#000000";
    ctx.font = "bold 20px Arial";
    ctx.textAlign = "left";
    
    // Draw lines between details
    ctx.strokeStyle = "#f0f0f0";
    ctx.lineWidth = 1;
    
    // LEFT COLUMN
    // Flat/Shop
    ctx.fillText(`Flat/Shop:`, 110, 870);
    ctx.fillText(`${data.flat}`, 280, 870);
    ctx.beginPath();
    ctx.moveTo(110, 880);
    ctx.lineTo(390, 880);
    ctx.stroke();
    
    // Name
    ctx.fillText(`Name:`, 110, 915);
    ctx.fillText(`${data.name}`, 280, 915);
    ctx.beginPath();
    ctx.moveTo(110, 925);
    ctx.lineTo(390, 925);
    ctx.stroke();
    
    // Amount
    ctx.fillText(`Amount:`, 110, 960);
    ctx.fillText(`‚Çπ${data.amount}`, 280, 960);
    ctx.beginPath();
    ctx.moveTo(110, 970);
    ctx.lineTo(390, 970);
    ctx.stroke();
    
    // RIGHT COLUMN
    // Purpose
    ctx.fillText(`Purpose:`, 410, 870);
    ctx.fillText(`${data.purpose}`, 550, 870);
    ctx.beginPath();
    ctx.moveTo(410, 880);
    ctx.lineTo(690, 880);
    ctx.stroke();
    
    // Month
    ctx.fillText(`Month:`, 410, 915);
    ctx.fillText(`${data.month}`, 550, 915);
    ctx.beginPath();
    ctx.moveTo(410, 925);
    ctx.lineTo(690, 925);
    ctx.stroke();
    
    // Empty row for balance
    ctx.beginPath();
    ctx.moveTo(410, 970);
    ctx.lineTo(690, 970);
    ctx.stroke();

    // Enhanced Warning box
    ctx.fillStyle = "#fff8e6";
    ctx.fillRect(80, 1040, 640, 80);
    ctx.strokeStyle = "#ff9800";
    ctx.lineWidth = 4;
    ctx.strokeRect(80, 1040, 640, 80);

    ctx.fillStyle = "#e65100";
    ctx.font = "bold 16px Arial";
    ctx.textAlign = "center";
    ctx.fillText("‚ö† Use this QR only once - Generate new QR for next payment", 400, 1070);
    ctx.fillText("‡§á‡§∏ QR ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡•á‡§µ‡§≤ ‡§è‡§ï ‡§¨‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç - ‡§®‡§à ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§®‡§Ø‡§æ QR ‡§¨‡§®‡§æ‡§è‡§Ç", 400, 1095);

    // Footer
    ctx.fillStyle = "#999999";
    ctx.font = "14px Arial";
    ctx.fillText("Generated by Kala Residency Online Payment System", 400, 1130);

    return canvas.toDataURL("image/jpeg", 0.95);
  }

  // Download QR handler
  document.getElementById('downloadQR').onclick = async() => {
    const framedQRData = await generateFramedQR();
    const link = document.createElement("a");
    link.href = framedQRData;
    link.download = `Kala_Residency_QR_${data.flat}_${data.month}.jpg`;
    link.click();
  };

  // Screenshot QR handler (same as download for this case)
  document.getElementById('screenshotQR').onclick = async() => {
    const framedQRData = await generateFramedQR();
    const link = document.createElement("a");
    link.href = framedQRData;
    link.download = `Kala_Residency_Receipt_${data.flat}_${data.month}.jpg`;
    link.click();
  };

});
</script>

</body>
</html>
